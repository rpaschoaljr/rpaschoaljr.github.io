<!DOCTYPE html>
<html>

<head>
    <title>Leitor de Código de Barras</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        video {
            width: 320px;
            height: 240px;
            border: 2px solid #ccc;
        }

        #barcode-value {
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #ccc;
        }

        .barcode-highlight {
            position: absolute;
            border: 2px solid red;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Leitor de Código de Barras</h1>
        <video id="video" autoplay></video>
        <input type="text" id="barcode-value" placeholder="Valor do Código de Barras">
        <canvas id="canvas" width="320" height="240"></canvas>
    </div>

    <!-- Bibliotecas Externas -->
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>

    <script>
        const video = document.getElementById('video');
        const barcodeValue = document.getElementById('barcode-value');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let codeReader;
        let intervalId;

        const ZXing = window.ZXing; // Certifique-se de que o ZXing está carregado

        codeReader = new ZXing.BrowserMultiFormatReader();

        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(stream => {
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    decodeBarcode();
                };
            })
            .catch(err => {
                console.error('Erro:', err);
                barcodeValue.value = "Erro ao acessar a câmera.";
            });

        function decodeBarcode() {
            if (!codeReader) return;

            codeReader.decodeFromVideoElement(video, canvas)
                .then(result => {
                    if (result) {
                        barcodeValue.value = result.text;
                        // Desenhar retângulo ao redor do código de barras (opcional)
                        drawResultPoints(result);
                    }
                })
                .catch(err => {
                    console.error('Erro na leitura do código de barras:', err);
                })
                .finally(() => {
                    intervalId = setTimeout(decodeBarcode, 500); // Executar a cada 500ms
                });
        }

        function drawResultPoints(result) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 2;
            for (let i = 0; i < result.resultPoints.length; i++) {
                const point = result.resultPoints[i];
                ctx.beginPath();
                ctx.arc(point.x, point.y, 5, 0, 2 * Math.PI);
                ctx.stroke();
            }
        }
    </script>
</body>

</html>
